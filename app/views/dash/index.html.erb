<div class="container">

  <div class="row" id="icenter">
    <h1>Viking Store Analytics Dashboard</h1>
  </div>
  <div class="row">
    <div class="col-xs-5 quad">
      <h3 id ="icenter">1. Overall Platform</h3>
      <h4>Last 7 Days</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr><th>Item</th>
          <th>Date</th></tr>
          <tr><td>New Users</td><td><%= @users.where("created_at > ?",Time.now-7.day).count%></td></tr>
          <tr><td>Orders</td><td><%= @orders.where("created_at > ?",Time.now-7.day).count%></td></tr>
          <tr><td>New Products</td><td><%= @products.where("created_at > ?",Time.now-7.day).count%></td></tr>
          <tr><td>Revenue</td><td>$<%= Order.where("checkout_date > ?", Time.now-7.day).joins("JOIN order_contents on orders.id = order_contents.order_id").joins("JOIN products on products.id = order_contents.product_id").sum("ROUND(products.price*order_contents.quantity,2)")%></td></tr>
      </table>
      <h4>Last 30 Days</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr><th>Item</th>
          <th>Date</th></tr>
          <tr><td>New Users</td><td><%= @users.where("created_at > ?",Time.now-30.day).count%></td></tr>
          <tr><td>Orders</td><td><%= @orders.where("created_at > ?",Time.now-30.day).count%></td></tr>
          <tr><td>New Products</td><td><%= @products.where("created_at > ?",Time.now-30.day).count%></td></tr>
          <tr><td>Revenue</td><td>$<%= Order.where("checkout_date > ?", Time.now-30.day).joins("JOIN order_contents on orders.id = order_contents.order_id").joins("JOIN products on products.id = order_contents.product_id").sum("ROUND(products.price*order_contents.quantity,2)")%></td></tr>

      </table>
      <h4>Total</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr><th>Item</th>
          <th>Date</th></tr>
          <tr><td>New Users</td><td><%= @users.count%></td></tr>
          <tr><td>Orders</td><td><%= @orders.count%></td></tr>
          <tr><td>New Products</td><td><%= @products.count%></td></tr>
          <tr><td>Revenue</td><td>$<%= Order.joins("JOIN order_contents on orders.id = order_contents.order_id").joins("JOIN products on products.id = order_contents.product_id").sum("ROUND(products.price*order_contents.quantity,2)")%></td></tr>
      </table>
    </div>
    <div class="col-xs-5 col-xs-offset-2 quad">
      <h3 id ="icenter">2. User Demographics and Behavior</h3>
      <h4>Top 3 States Users Live In (billing)</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr><th>Item</th>
          <th>Data</th></tr>
          <% State.joins("JOIN addresses on states.id = addresses.state_id").joins("JOIN users on addresses.id = users.shipping_id").select("states.name, count(name)").group("states.name").order("count(name) desc").limit(3).each do |state| %>
          <tr><td><%=state.name%></td><td><%=state.count%></td></tr>
          <%end%>
      </table>
      <h4>Top 3 Cities Users Live In (billing)</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr><th>Item</th>
          <th>Date</th></tr>
          <% City.joins("JOIN addresses on cities.id = addresses.city_id").joins("JOIN users on addresses.id = users.shipping_id").select("cities.name, count(name)").group("cities.name").order("count(name) desc").limit(3).each do |city| %>
          <tr><td><%=city.name%></td><td><%=city.count%></td></tr>
          <%end%>
      </table>
      <h4>Top Users With...</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr><th>Item</th><th>Date</th></tr>
        <tr><td>Highest Single Order Value</td><td><%=@single.first_name + " " + @single.last_name%></td><td>$<%=@single.sum%></td></tr>
        <tr><td>Highest Lifetime Value</td><td><%=@lifetime.first_name + " " + @lifetime.last_name%></td><td>$<%=@lifetime.sum%></td></tr>
        <tr><td>Most Orders Placed</td><td><%=@mostorders.first_name + " " + @mostorders.last_name%></td><td><%=@mostorders.count%></td></tr>
      </table>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-5 quad">
      <h3 id ="icenter">3. Order Statistics</h3>
      <h4>Last 7 Days</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr><th>Item</th>
          <th>Date</th></tr>
          <tr><td>Number of Orders</td><td><%=Order.where("checkout_date > ?",Time.now-7.day).count%></td></tr>
          <tr><td>Total Revenue</td><td>$<%= Order.where("checkout_date > ?", Time.now-7.day).joins("JOIN order_contents on orders.id = order_contents.order_id").joins("JOIN products on products.id = order_contents.product_id").sum("ROUND(products.price*order_contents.quantity,2)")%></td></tr>
          <tr><td>Average Order Value</td><td>bloo</td></tr>
          <tr><td>Largest Order Value</td><td>bloo</td></tr>
      </table>
      <h4>Last 30 days</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr><th>Item</th>
          <th>Date</th></tr>
          <tr><td>Number of Orders</td><td><%=Order.where("checkout_date > ?",Time.now-30.day).count%></td></tr>
          <tr><td>Total Revenue</td><td>$<%= Order.where("checkout_date > ?", Time.now-30.day).joins("JOIN order_contents on orders.id = order_contents.order_id").joins("JOIN products on products.id = order_contents.product_id").sum("ROUND(products.price*order_contents.quantity,2)")%></td></tr>
          <tr><td>Average Order Value</td><td>bloo</td></tr>
          <tr><td>Largest Order Value</td><td>bloo</td></tr>
      </table>
      <h4>Total</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr><th>Item</th>
          <th>Date</th></tr>
          <tr><td>Number of Orders</td><td><%=Order.count%></td></tr>
          <tr><td>Total Revenue</td><td>$<%= Order.where("checkout_date > ?", Time.now-7.day).joins("JOIN order_contents on orders.id = order_contents.order_id").joins("JOIN products on products.id = order_contents.product_id").sum("ROUND(products.price*order_contents.quantity,2)")%></td></tr>
          <tr><td>Average Order Value</td><td>bloo</td></tr>
          <tr><td>Largest Order Value</td><td>bloo</td></tr>
      </table>
    </div>
    <div class="col-xs-5 col-xs-offset-2 quad">
      <h3 id ="icenter">4. Time Series Data</h3>
      <h4>Orders by Day</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr><th>Item</th>
          <th>Date</th></tr>
          <tr><td>blah</td><td>bloo</td></tr>
      </table>
      <h4>Orders by Week</h4>
      <table class="table table-bordered table-condensed table-striped">
        <tr><th>Item</th>
          <th>Date</th></tr>
          <tr><td>blah</td><td>bloo</td></tr>
      </table>
      </div>
  </div>
</div>
