<% @page_title = " | Edit Order" %>

<% if flash[:alert] %>
  <div class="notice">
    <%= flash[:alert] %>
  </div>
<% end %>

<%= render :partial => "edit_or_new_form",
           :locals => {:form_type => "edit",
                       :form_header => "Edit Order #{@order.id}",
                       :order => @order,
                       :user => @user,
                       :submit_label => "Update Order Information"
                       } %>

<div class="crud-container">
	<div class="row">
	  <div class="col-md-12 text-center crud-header">

	    <h3>Edit Order Contents</h3>

			<%= form_for @order do |f| %>
			<%= hidden_field_tag 'user_id', @user.id %>
	    	<div class="stats-table">
				  <table class="table table-striped">
				    <tr>
				      <% @column_headers.each do |header| %>
				        <th><%= header %></th>
				      <% end %>
				    </tr>
			    	<%= f.fields_for :order_contents do |order_content| %>
			    		<tr>
			    			<td>
			    				<%= order_content.object.id %>
			    			</td>
			    			<td>
			    				<%= order_content.text_field :quantity %>
			    			</td>
			    			<td>
			    				<%= "$#{order_content.object.product.price}" if order_content.object.product %>
			    			</td>
			        	<td>
			        		<%= "$#{order_content.object.product.price * order_content.object.quantity}" if order_content.object.product %>
			        	</td>
			        	<td>
			        		<%= order_content.check_box '_destroy' %>
			        	</td>
			    		</tr>
		    		<% end %>
					</table>
					<%= f.submit %>
				</div>
			<% end %>

	  </div>
	</div>

	<div class="row">
    <div class="col-xs-12">

      <%= link_to 'Delete Order', order_path,
                                  data: {:confirm => 'Are you sure?'},
                                  :method => :delete %>

    </div>
  </div>
</div>

<div class="crud-container">
	<div class="row">
	  <div class="col-md-12 text-center crud-header">

	    <h3>Add Products to Order</h3>
	    <h6>Add up to 5 products at a time</h6>

			<%= form_for @order do |f| %>
			<%= hidden_field_tag 'user_id', @user.id %>
	    	<div class="stats-table">
				  <table class="table table-striped">
				    <tr>
				      <th>Product ID</th>
				      <th>Quantity</th>
				    </tr>
				    <% 5.times do %>
				    	<%= f.fields_for :order_contents, @order.order_contents.build do |order_content| %>
				    		<tr>
				    			<td>
				    				<%= order_content.text_field :product_id %>
				    			</td>
				    			<td>
				    				<%= order_content.text_field :quantity, :value => nil %>
				    			</td>
				    		</tr>
			    		<% end %>
			    	<% end %>
					</table>
					<%= f.submit %>
				</div>
			<% end %>

	  </div>
	</div>
</div>