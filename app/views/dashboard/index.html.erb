<h1 class='text-center'> The Viking Store Analytics Dashboard </h1>

<div class='container'>
  <div class='row'>
    <div class='col-sm-6'>
      <h2 class='text-center'>1. Overall Platform</h2>
      <h3>Last 7 Days</h3>
      <table class='table'>
        <tr>
          <th>Item</th>
          <th>Data</th>
        </tr>

        <tr>
          <td>New Users</td>
          <td><%= @users.new_users_since(Time.now - 7.days) %></td>
        </tr>

        <tr>
          <td>Orders</td>
          <td><%= @orders.new_orders_since(Time.now - 7.days) %></td>
        </tr>

        <tr>
          <td>New Products</td>
          <td><%= @products.new_products_since(Time.now - 7.days) %></td>
        </tr>

        <tr>
          <td>Revenue</td>
          <td><%= @order_contents.revenue_since(Time.now - 7.days) %></td>
        </tr>
      </table>

      <h3>Last 30 Days</h3>
      <table class='table'>
        <tr>
          <th>Item</th>
          <th>Data</th>
        </tr>

        <tr>
          <td>New Users</td>
          <td><%= @users.new_users_since(Time.now - 30.days) %></td>
        </tr>

        <tr>
          <td>Orders</td>
          <td><%= @orders.new_orders_since(Time.now - 30.days) %></td>
        </tr>

        <tr>
          <td>New Products</td>
          <td><%= @products.new_products_since(Time.now - 30.days) %></td>
        </tr>

        <tr>
          <td>Revenue</td>
          <td><%= @order_contents.revenue_since(Time.now - 30.days) %></td>
        </tr>
      </table>

      <h3>Total</h3>
      <table class='table'>
        <tr>
          <th>Item</th>
          <th>Data</th>
        </tr>

        <tr>
          <td>Users</td>
          <td><%= @users.total_users %></td>
        </tr>

        <tr>
          <td>Orders</td>
          <td><%= @orders.total_orders %></td>
        </tr>

        <tr>
          <td>Products</td>
          <td><%= @products.total_products %></td>
        </tr>

        <tr>
          <td>Revenue</td>
          <td><%= @order_contents.total_revenue %></td>
        </tr>
      </table>

    </div>

    <div class='col-sm-6'>
      <h2 class='text-center'>2. User Demographics and Behavior</h2>
        <h3>Top 3 States Users Live In (Billing)</h3>
      <table class='table'>
        <tr>
          <th>Item</th>
          <th>Data</th>
        </tr>
          <% @users.top_user_states.each do |state| %>
          <tr>
            <td><%= state.name %></td>
            <td><%= state.count %></td>
          </tr>
          <%end%>
        
      </table>

      <h3>Top 3 Cities Users Live In (Billing)</h3>
      <table class='table'>
        <tr>
          <th>Item</th>
          <th>Data</th>
        </tr>
        <% @users.top_user_cities.each do |city| %>
          <tr>
            <td><%= city.name %></td>
            <td><%= city.count %></td>
          </tr>
        <%end%>

      </table>

      <h3>Top User With..</h3>
      <table class='table'>
        <tr>
          <th>Item</th>
          <th>User</th>
          <th>Quantity</th>
        </tr>

        <tr>
          <td>Highest Single Order Value</td>
          <td><%= @users.highest_single_order_value.full_name %></td>
          <td><%= @users.highest_single_order_value.sum %></td>
        </tr>

        <tr>
          <td>Highest Lifetime Value</td>
          <td><%= @users.highest_lifetime_value.full_name %></td>
          <td><%= @users.highest_lifetime_value.sum %></td>
        </tr>

        <tr>
          <td>Highest Average Order Value</td>
          <td><%= @users.highest_average_order_value.first_name %> <%= @users.highest_average_order_value.last_name %></td>
          <td><%= @users.highest_average_order_value.average %></td>
        </tr>

        <tr>
          <td>Most Orders Placed</td>
          <td><%= @users.most_orders.first_name %> <%= @users.most_orders.last_name %></td>
          <td><%= @users.most_orders.orders %></td>
        </tr>
      </table>
      
    </div>
  </div>
</div>

<div class='container'>
  <div class='row'>
    <div class='col-sm-6'>
      <h2 class='text-center'>3. Order Statistics</h2>
      <h3>Last 7 Days</h3>
      <table class='table'>
        <tr>
          <th>Item</th>
          <th>Data</th>
        </tr>
        <tr>
          <td>Orders</td>
          <td><%= @orders.new_orders_since(Time.now - 7.days) %></td>
        </tr>

        <tr>
          <td>Total Revenue</td>
          <td><%= @order_contents.revenue_since(Time.now - 7.days) %></td>
        </tr>

        <tr>
          <td>Ave Order Value</td>
          <td><%= @orders.order_value_avg_since(Time.now - 7.days) %></td>
        </tr>

        <tr>
          <td>Largest Order Value</td>
          <td><%= @orders.order_value_max_since(Time.now - 7.days) %></td>
        </tr>

      </table>
      <h3>Last 30 Days</h3>
      <table class='table'>
        <tr>
          <th>Item</th>
          <th>Data</th>
        </tr>
        <tr>
          <td>Orders</td>
          <td><%= @orders.new_orders_since(Time.now - 30.days) %></td>
        </tr>

        <tr>
          <td>Revenue</td>
          <td><%= @order_contents.revenue_since(Time.now - 30.days) %></td>
        </tr>

        <tr>
          <td>Ave Order Value</td>
          <td><%= @orders.order_value_avg_since(Time.now - 30.days) %></td>
        </tr>

        <tr>
          <td>Largest Order Value</td>
          <td><%= @orders.order_value_max_since(Time.now - 30.days) %></td>
        </tr>
      </table>
       <h3>Total</h3>
      <table class='table'>
        <tr>
          <th>Item</th>
          <th>Data</th>
        </tr>
        <tr>
          <td>Number of Orders</td>
          <td><%= @orders.total_orders %></td>
        </tr>
        <tr>
          <td>Total Revenue</td>
          <td><%= @order_contents.total_revenue %></td>
        </tr>

        <tr>
          <td>Ave Order Value</td>
          <td><%= @orders.order_value_avg %></td>
        </tr>

        <tr>
          <td>Largest Order Value</td>
          <td><%= @orders.order_value_max %></td>
        </tr>
      </table>

    </div>


    <div class='col-sm-6'>
      <h2 class='text-center'>4. Time Series Data</h2>
      <h3>Orders by Day</h3>
      <table class='table'>
      </table>
      <h3>Orders by Week</h3>
      <table class='table'>
      </table>
    </div>
  </div>
</div>