<!-- index.html.erb -->

<!-- Dashboard display -->

<div class="container">
  <h1 class="text-center">Viking Store Analytics Dashboard</h1>
  <br>

  <div class="row"> <!-- first row -->
    <div class="col-xs-6 well"> <!-- left col -->



      <!-- 1. Overall Platform -->

      <h3 class="text-center">1. Overall Platform</h3>
      <br><br>
      <h4>Last 7 Days</h4>
      <table class="table table-striped table-bordered table-bordered">  <!-- first table -->
        <thead>
          <tr>
            <th>Item</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>New Users</td>
            <td>
              <%= @users_seven_days || "No users!"  %> 
            </td>
          </tr>
          <tr>
            <td>Orders</td>
            <td>
              <%= @orders_seven_days || "No orders!" %>
            </td>
          </tr>
          <tr>
            <td>New Products</td>
            <td>
              <%= @products_seven_days || "No products!"  %>
            </td>
          </tr>
          <tr>
            <td>Revenue</td>
            <td>
              <%= @revenue_seven_days || "No revenue!"  %>
            </td>
          </tr>
        </tbody>
      </table> <!-- end first table -->
      <br>

      <h4>Last 30 Days</h4>
      <table class="table table-striped table-bordered">  <!-- second table -->
        <thead>
          <tr>
            <th>Item</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>New Users</td>
            <td>
              <%= @users_thirty_days || "No users!"  %>
            </td>
          </tr>
          <tr>
            <td>Orders</td>
            <td>
              <%= @orders_thirty_days || "No orders!" %>
            </td>
          </tr>
          <tr>
            <td>New Products</td>
            <td>
              <%= @products_thirty_days || "No products!" %>
            </td>
          </tr>
          <tr>
            <td>Revenue</td>
            <td>
              <%= @revenue_thirty_days || "No revenue!" %>
            </td>
          </tr>
        </tbody>
      </table> <!-- end second table -->
      <br>

      <h4>Total</h4>
      <table class="table table-striped table-bordered">  <!-- third table -->
        <thead>
          <tr>
            <th>Item</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>New Users</td>
            <td>
              <%= @users_total || "No users!"  %>
            </td>
          </tr>
          <tr>
            <td>Orders</td>
            <td>
              <%= @orders_total || "No orders!" %>
            </td>
          </tr>
          <tr>
            <td>New Products</td>
            <td>
              <%= @products_total || "No products!" %>
            </td>
          </tr>
          <tr>
            <td>Revenue</td>
            <td>
              <%= @revenue_total || "No revenue!" %>
            </td>
          </tr>
        </tbody>
      </table> <!-- end third table -->
      <br>
    </div> <!-- end left col -->


    <div class="col-xs-6 well"> <!-- right col -->
      <h3 class="text-center">2. User Demographics</h3>
      <h3 class="text-center">and Behavior</h3>
      <br>

      <!-- 2. User Demographics and Behavior-->

      <h4>Top 3 States Users Live In (billing)</h4>
      <table class="table table-striped table-bordered">  <!-- first table -->
        <thead>
          <tr>
            <th>Item</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody>
          <% @top_states.each do |state| %> <!-- 3 states -->
            <tr>
              <td>
                <%= state.name %>
              </td>
              <td>
                <%= state.count_in_states %> 
              </td>
            </tr>
          <% end %>
        </tbody>
      </table> <!-- end first table -->
      <br>

      <h4>Top 3 Cities Users Live In (billing)</h4>
      <table class="table table-striped table-bordered">  <!-- first table -->
        <thead>
          <tr>
            <th>Item</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody>
          <% @top_cities.each do |city| %> <!-- 3 states -->
            <tr>
              <td>
                <%= city.name %>
              </td>
              <td>
                <%= city.count_in_cities %> 
              </td>
            </tr>
          <% end %>
        </tbody>
      </table> <!-- end first table -->
      <br>

      <h4>Top User With ...</h4>
      <table class="table table-striped table-bordered">  <!-- first table -->
        <thead>
          <tr>
            <th>Item</th>
            <th>User</th>
            <th>Quantity</th>
          </tr>
        </thead>
        <tbody>
          <% @hsov.each do |value| %>
            <tr>
              <td>
                Highest Single Order Value
              </td>
              <td>
                <%= value.user_name %>
              </td>
              <td>
                <%= "$#{value.order_value}" %> 
              </td>
            </tr>
          <% end %>
          <% @hlov.each do |value| %>
            <tr>
              <td>
                Highest Lifetime Value
              </td>
              <td>
                <%= value.user_name %>
              </td>
              <td>
                <%= "$#{value.lifetime_order_value}" %> 
              </td>
            </tr>
          <% end %>
          <% @haov.each do |value| %>
            <tr>
              <td>
                Highest Average Order Value
              </td>
              <td>
                <%= value.user_name %>
              </td>
              <td>
                <%= "$#{value.average_order_value}" %> 
              </td>
            </tr>
          <% end %>
          <% @most_orders_placed.each do |value| %>
            <tr>
              <td>
                Most Orders Placed
              </td>
              <td>
                <%= value.user_name %>
              </td>
              <td>
                <%= "$#{value.most_orders_placed}" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table> <!-- end first table -->
      <br>

    </div> <!-- end right col -->
  </div>  <!-- end first row -->
    

  <div class="row"> <!-- second row -->
    <div class="col-xs-6 well"> <!-- left col -->
      <h3 class="text-center">3. Order Statistics</h3>
      <br><br>

      <!-- 3. Order Statistics -->

      <h4>Last 7 Days</h4>
      <table class="table table-striped table-bordered">  <!-- first table -->
        <thead>
          <tr>
            <th>Item</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Number of Orders</td>
            <td>
              <%= @orders_seven_days || "No orders!"  %> 
            </td>
          </tr>
          <tr>
            <td>Total Revenue</td>
            <td>
              <%= @revenue_seven_days || "No revenue!" %>
            </td>
          </tr>
          <tr>
            <td>Average Order Value</td>
              <% @average_seven_days.each do |value| %>
                <td>
                  <%= "$#{value.average_order_value}" || "No orders!"  %>
                </td>
              <% end %>
          </tr>
          <tr>
            <td>Largest Order Value</td>
              <% @max_seven_days.each do |value| %>
                <td>AAAAA
                  <!-- <%= "$#{value.largest_order_value}" || "No orders!"  %> -->
                </td>
              <% end %>
          </tr>
        </tbody>
      </table> <!-- end first table -->
      <br>

      <h4>Last 30 Days</h4>
      <table class="table table-striped table-bordered">  <!-- second table -->
        <thead>
          <tr>
            <th>Item</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Number of Orders</td>
            <td>
              <%= @orders_thirty_days || "No orders!"  %> 
            </td>
          </tr>
          <tr>
            <td>Total Revenue</td>
            <td>
              <%= @revenue_thirty_days || "No revenue!" %>
            </td>
          </tr>
          <tr>
            <td>Average Order Value</td>
            <% @average_thirty_days.each do |value| %>
              <td>
                <%= "$#{value.average_order_value}" || "No orders!"  %>
              </td>
            <% end %>
          </tr>
          <tr>
            <td>Largest Order Value</td>
            <% @max_thirty_days.each do |value| %>
              <td>
                <%= "$#{value.largest_order_value}" || "No orders!"  %>
              </td>
            <% end %>
          </tr>
        </tbody>
      </table> <!-- end second table -->
      <br>

      <h4>Total</h4>
      <table class="table table-striped table-bordered">  <!-- third table -->
        <thead>
          <tr>
            <th>Item</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Number of Orders</td>
            <td>
              <%= @orders_total || "No orders!"  %> 
            </td>
          </tr>
          <tr>
            <td>Total Revenue</td>
            <td>
              <%= @revenue_total || "No revenue!" %>
            </td>
          </tr>
          <tr>
            <td>Average Order Value</td>
            <% @average_total.each do |value| %>
              <td>
                <%= "$#{value.average_order_value}" || "No orders!"  %>
              </td>
            <% end %>
          </tr>
          <tr>
            <td>Largest Order Value</td>
            <% @max_total.each do |value| %>
              <td>
                <%= "$#{value.largest_order_value}" || "No orders!"  %>
              </td>
            <% end %>
          </tr>
        </tbody>
      </table> <!-- end third table -->
      <br>

    </div> <!-- end left col -->

    <div class="col-xs-6 well"> <!-- right col -->
      <h3 class="text-center">4. Time Series Data</h3>
      <br><br>

      <!-- 4. Time Series Data -->
      <!-- to complete -->
      
      <h4>Orders by Day</h4>
      <table class="table table-striped table-bordered">  <!-- second table -->
        <thead>
          <tr>
            <th>Date</th>
            <th>Quantity</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody>
          <% @orders_by_day.each do |item| %>
            <tr>
              <td>
                <% if days_ago == 0 %>
                  Today
                <% if days_ago == 1 %>
                  Yesterday
                <% else %>
                  <%= (Time.now - item.days_ago.days).beginning_of_day.strftime('%_m/%-d') %>
              </td>
              <td>
                <%= item.quantity %> 
              </td>
              <td>
                <%= "$#{item.value}" %> 
              </td>
            </tr>
          <% end %>
        </tbody>
        <tbody>
          <% @orders_by_week.each do |item| %>
            <tr>
              <td>
                <%= Time.now - item.weeks_ago.weeks).beginning_of_week.strftime('%_m/%-d') %>
              </td>
              <td>
                <%= item.quantity %> 
              </td>
              <td>
                <%= "$#{item.value}" %> 
              </td>
            </tr>
          <% end %>
        </tbody>

    </div> <!-- end right col -->
  </div>  <!-- end second row -->

</div> <!-- end container -->



